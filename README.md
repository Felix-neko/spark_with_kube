# spark_with_kube

ะะฐะทะพะฒัะน ะฟัะธะผะตั ะดะปั ะทะฐะฟััะบะฐ PySpark ะฒ **client mode** ั executor'ะฐะผะธ ะฒ Kubernetes.

## ๐ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะญัะพั ะฟัะพะตะบั ะดะตะผะพะฝัััะธััะตั, ะบะฐะบ ะทะฐะฟัััะธัั Apache Spark ะฟัะธะปะพะถะตะฝะธะต ะฝะฐ Python, ะณะดะต:
- **Driver** ัะฐะฑะพัะฐะตั ะปะพะบะฐะปัะฝะพ ะฝะฐ ะฒะฐัะตะน ะผะฐัะธะฝะต (ะฒะฝะต Kubernetes)
- **Executor'ั** ะทะฐะฟััะบะฐัััั ะบะฐะบ ะฟะพะดั ะฒะฝัััะธ Kubernetes ะบะปะฐััะตัะฐ
- ะะพะผะผัะฝะธะบะฐัะธั ะผะตะถะดั driver ะธ executor'ะฐะผะธ ะฟัะพะธััะพะดะธั ัะตัะตะท ัะฟะตัะธะฐะปัะฝัะน proxy Service

## ๐๏ธ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

### ะัะฝะพะฒะฝัะต ัะฐะนะปั

#### `pyspark_on_kube_example.py`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะะปะฐะฒะฝัะน Python ัะบัะธะฟั ั ะฟัะธะผะตัะพะผ Spark ะฟัะธะปะพะถะตะฝะธั.

**ะงัะพ ะดะตะปะฐะตั:**
- ะกะพะทะดะฐะตั SparkSession ั ะบะพะฝัะธะณััะฐัะธะตะน ะดะปั Kubernetes
- ะะฐัััะฐะธะฒะฐะตั ะฐััะตะฝัะธัะธะบะฐัะธั ัะตัะตะท minikube ัะตััะธัะธะบะฐัั
- ะะฐะฟััะบะฐะตั ัะตััะพะฒัะน job (ะฟะพะดััะตั ัะธัะตะป ะพั 0 ะดะพ 999)
- ะะตะผะพะฝัััะธััะตั ัะฐะฑะพัั Spark ะฒ client mode

**ะะปััะตะฒัะต ะฝะฐัััะพะนะบะธ:**
- `spark.submit.deployMode=client` - driver ะปะพะบะฐะปัะฝะพ, executor'ั ะฒ K8s
- `spark.driver.host=driver-proxy.spark.svc.cluster.local` - ะฐะดัะตั ะดะปั executor'ะพะฒ
- `spark.kubernetes.authenticate.driver.serviceAccountName=spark-client` - RBAC

---

#### `spark-rbac.yaml`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฐัััะพะนะบะฐ RBAC (Role-Based Access Control) ะดะปั Spark.

**ะงัะพ ัะพะทะดะฐะตั:**
1. **Namespace `spark`** - ะธะทะพะปะธัะพะฒะฐะฝะฝะพะต ะฟัะพัััะฐะฝััะฒะพ ะดะปั Spark ัะตััััะพะฒ
2. **ServiceAccount `spark-client`** - ะธะดะตะฝัะธัะธะบะฐัะพั ะดะปั Spark driver'ะฐ
3. **Role `spark-role`** - ะฝะฐะฑะพั ัะฐะทัะตัะตะฝะธะน (ัะพะทะดะฐะฝะธะต pods, services, configmaps, secrets)
4. **RoleBinding `spark-rolebinding`** - ัะฒัะทัะฒะฐะตั ServiceAccount ั Role

**ะะฐัะตะผ ะฝัะถะฝะพ:**
Spark driver ะดะพะปะถะตะฝ ะธะผะตัั ะฟัะฐะฒะฐ ะฒ Kubernetes ะดะปั ัะพะทะดะฐะฝะธั ะธ ัะฟัะฐะฒะปะตะฝะธั executor ะฟะพะดะฐะผะธ.
ะะตะท ััะธั ะฟัะฐะฒ Spark ะฝะต ัะผะพะถะตั ะทะฐะฟัััะธัั executor'ั.

---

#### `driver-proxy.yaml`
**ะะฐะทะฝะฐัะตะฝะธะต:** Service ะธ Endpoints ะดะปั ะฟัะพะบัะธัะพะฒะฐะฝะธั ััะฐัะธะบะฐ ะธะท K8s ะฝะฐ ะปะพะบะฐะปัะฝัั ะผะฐัะธะฝั.

**ะัะพะฑะปะตะผะฐ, ะบะพัะพััั ัะตัะฐะตั:**
ะ client mode driver ัะฐะฑะพัะฐะตั ะฒะฝะต ะบะปะฐััะตัะฐ, ะฝะพ executor'ั ะฒะฝัััะธ ะบะปะฐััะตัะฐ ะดะพะปะถะฝั
ะฟะพะดะบะปััะฐัััั ะบ driver'ั. Executor'ั ะฝะต ะผะพะณัั ะฝะฐะฟััะผัั ะดะพััััะฐัััั ะดะพ ะฒะฐัะตะน ะผะฐัะธะฝั.

**ะะตัะตะฝะธะต:**
- ะกะพะทะดะฐะตััั Service `driver-proxy` ะฑะตะท selector'ะฐ
- ะัััะฝัั ัะพะทะดะฐัััั Endpoints, ัะบะฐะทัะฒะฐััะธะต ะฝะฐ IP ะฒะฐัะตะน ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝั
- Executor'ั ะฟะพะดะบะปััะฐัััั ะบ `driver-proxy.spark.svc.cluster.local`
- ะขัะฐัะธะบ ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตััั ะฝะฐ ะฒะฐัั ะผะฐัะธะฝั ัะตัะตะท Endpoints

**ะะพััั:**
- `7077` - RPC ะบะพะผะผัะฝะธะบะฐัะธั driver-executor
- `7078` - BlockManager (ะฟะตัะตะดะฐัะฐ ะดะฐะฝะฝัั)
- `4040` - Spark Web UI

**โ๏ธ ะะะะะ:** ะ ัะฐะนะปะต ะฝัะถะฝะพ ัะบะฐะทะฐัั ะฐะบััะฐะปัะฝัะน IP ะฒะฐัะตะน ะผะฐัะธะฝั!

---

#### `spark-app-banning-policy.yaml`
**ะะฐะทะฝะฐัะตะฝะธะต:** Kyverno ClusterPolicy ะดะปั ะฒัะตะผะตะฝะฝะพะณะพ ะทะฐะฟัะตัะฐ ะทะฐะฟััะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ Spark ะฟัะธะปะพะถะตะฝะธั.

**ะงัะพ ะดะตะปะฐะตั:**
- ะะปะพะบะธััะตั ัะพะทะดะฐะฝะธะต ะฟะพะดะพะฒ ั ะผะตัะบะพะน `spark-app-selector=pyspark-k8s-client`
- ะัะธะผะตะฝัะตััั ัะพะปัะบะพ ะบ ServiceAccount `spark-client` ะฒ namespace `spark`
- ะะฒัะพะผะฐัะธัะตัะบะธ ัะดะฐะปัะตััั ัะตัะตะท 15 ะผะธะฝัั ั ะฟะพะผะพััั Kubernetes Job

**ะะพะผะฟะพะฝะตะฝัั:**
1. **ClusterPolicy** - ะฟัะฐะฒะธะปะพ ะฒะฐะปะธะดะฐัะธะธ Kyverno
2. **Job** - ัะดะฐะปัะตั ะฟะพะปะธัะธะบั ัะตัะตะท 15 ะผะธะฝัั (sleep 900)
3. **ServiceAccount** - ะดะปั Job ั ะฟัะฐะฒะฐะผะธ ะฝะฐ ัะดะฐะปะตะฝะธะต ClusterPolicy
4. **ClusterRole + ClusterRoleBinding** - RBAC ะดะปั ัะดะฐะปะตะฝะธั ะฟะพะปะธัะธะบ

**ะัะธะผะตะฝะตะฝะธะต:**
```bash
kubectl apply -f spark-app-banning-policy.yaml
```

---

#### `setup_minikube.sh`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะบัะธะฟั ะดะปั ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะน ะฝะฐัััะพะนะบะธ minikube ะบะปะฐััะตัะฐ.

**ะงัะพ ะดะตะปะฐะตั:**
- ะฃะดะฐะปัะตั ััะฐััะน minikube ะบะปะฐััะตั
- ะะฐัััะฐะธะฒะฐะตั ัะธััะตะผะฝัะต ะฟะฐัะฐะผะตััั (inotify limits)
- ะะฐะฟััะบะฐะตั minikube ั Docker driver
- ะะบะปััะฐะตั ะฝะตะพะฑัะพะดะธะผัะต addons (metrics-server, storage, ingress)

**ะะฐัะฐะผะตััั ะทะฐะฟััะบะฐ:**
- 8 CPU cores
- 32 GB RAM
- 100 GB disk

---

#### `install.sh`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะบัะธะฟั ะดะปั ัััะฐะฝะพะฒะบะธ ะฒัะตั ะฝะตะพะฑัะพะดะธะผัั ะบะพะผะฟะพะฝะตะฝัะพะฒ ะฒ Kubernetes.

**ะงัะพ ัััะฐะฝะฐะฒะปะธะฒะฐะตั:**
1. ะกะพะทะดะฐะตั namespace `spark`
2. ะัะธะผะตะฝัะตั driver-proxy Service ะธ Endpoints
3. ะัะธะผะตะฝัะตั RBAC ะฟัะฐะฒะธะปะฐ
4. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั Kyverno (policy engine)
5. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั Kyverno Policies
6. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั Policy Reporter (UI ะดะปั ะฟัะพัะผะพััะฐ ะฟะพะปะธัะธะบ)
7. ะะฐะฟััะบะฐะตั port-forward ะดะปั Policy Reporter UI ะฝะฐ ะฟะพัั 8082

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
```bash
./install.sh
```

---

#### `apply-ban-policy.sh` (cluster-scoped)
**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะบัะธะฟั ะดะปั ะฟัะธะผะตะฝะตะฝะธั ะฟะพะปะธัะธะบะธ ะฑะฐะฝะฐ ะฒะพ ะฒัะตะผ ะบะปะฐััะตัะต.

**ะงัะพ ะดะตะปะฐะตั:**
1. ะัะธะผะตะฝัะตั `spark-app-banning-policy.yaml` (ClusterPolicy)
2. ะะดะตั ะทะฐะฟััะบะฐ Job ะดะปั ะฝะตะผะตะดะปะตะฝะฝะพะณะพ ัะดะฐะปะตะฝะธั ะฟะพะดะพะฒ
3. ะะพะบะฐะทัะฒะฐะตั ะปะพะณะธ Job
4. ะัะพะฒะตััะตั ัะตะทัะปััะฐั

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
```bash
./apply-ban-policy.sh
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะฟะพะปัะทัะตั `ClusterPolicy` (ะดะตะนััะฒัะตั ะฒะพ ะฒัะตั namespaces)
- ะัะธะผะตะฝัะตััั ะะะ ัะปะฐะณะฐ `-n`
- ะะตััััั ัะพะทะดะฐัััั ะฒ ัะฐะทะฝัั namespaces

---

#### `apply-ban-policy-namespaced.sh` (namespaced)
**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะบัะธะฟั ะดะปั ะฟัะธะผะตะฝะตะฝะธั ะฟะพะปะธัะธะบะธ ะฑะฐะฝะฐ ะฒ ะบะพะฝะบัะตัะฝะพะผ namespace.

**ะงัะพ ะดะตะปะฐะตั:**
1. ะัะธะผะตะฝัะตั `spark-app-banning-policy-namespaced.yaml` (Policy)
2. ะะดะตั ะทะฐะฟััะบะฐ Job
3. ะะพะบะฐะทัะฒะฐะตั ะปะพะณะธ ะธ ัะตะทัะปััะฐั

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
```bash
# ะัะธะผะตะฝะธัั ะฒ namespace 'spark' (ะฟะพ ัะผะพะปัะฐะฝะธั)
./apply-ban-policy-namespaced.sh

# ะัะธะผะตะฝะธัั ะฒ ะดััะณะพะผ namespace
./apply-ban-policy-namespaced.sh production
./apply-ban-policy-namespaced.sh dev
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะฟะพะปัะทัะตั `Policy` (ะดะตะนััะฒัะตั ัะพะปัะบะพ ะฒ ะพะดะฝะพะผ namespace)
- Namespace ะทะฐะดะฐะตััั ะบะฐะบ ะฟะฐัะฐะผะตัั ัะบัะธะฟัะฐ
- ะัะต ัะตััััั ัะพะทะดะฐัััั ะฒ ะพะดะฝะพะผ namespace
- ะะพะปะตะต ะณะธะฑะบะธะน ะธ ะฑะตะทะพะฟะฐัะฝัะน

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- โ Executor'ั ะฒ ะพะดะฝะพะผ namespace
- โ ะัะถะฝะฐ ะธะทะพะปััะธั ะผะตะถะดั ะพะบััะถะตะฝะธัะผะธ
- โ ะฅะพัะธัะต ะทะฐะดะฐะฒะฐัั namespace ะฒ ัะบัะธะฟัะต

---

#### `pyproject.toml`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะฝัะธะณััะฐัะธั Python ะฟัะพะตะบัะฐ ะธ ะทะฐะฒะธัะธะผะพััะตะน.

**ะะฐะฒะธัะธะผะพััะธ:**
- `pyspark` - Apache Spark ะดะปั Python

**ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ:**
ะัะพะตะบั ะธัะฟะพะปัะทัะตั `uv` (ัะพะฒัะตะผะตะฝะฝัะน ะผะตะฝะตะดะถะตั ะฟะฐะบะตัะพะฒ Python).

---

#### `.gitignore`
**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะฟะธัะพะบ ัะฐะนะปะพะฒ ะธ ะดะธัะตะบัะพัะธะน, ะธะณะฝะพัะธััะตะผัั Git.

**ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั:**
- `.venv/` - ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต Python
- `__pycache__/` - ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะต Python ัะฐะนะปั
- `.idea/` - ะฝะฐัััะพะนะบะธ PyCharm/IntelliJ
- ะธ ะดััะณะธะต ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

```bash
# ะะฐะฟัััะธัั minikube (ะตัะปะธ ะตัะต ะฝะต ะทะฐะฟััะตะฝ)
./setup_minikube.sh

# ะฃััะฐะฝะพะฒะธัั ะฒัะต ะบะพะผะฟะพะฝะตะฝัั ะฒ Kubernetes
./install.sh

# ะกะพะทะดะฐัั Python ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ะธ ัััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
uv venv
source .venv/bin/activate
uv pip install -e .
```

### 2. ะัะพะฒะตัะบะฐ IP ะฐะดัะตัะฐ

ะัะพะฒะตัััะต, ััะพ IP ะฒ `driver-proxy.yaml` ัะพะพัะฒะตัััะฒัะตั IP ะฒะฐัะตะน ะผะฐัะธะฝั:

```bash
ip addr show | grep "inet "
```

ะัะปะธ IP ะพัะปะธัะฐะตััั, ะพะฑะฝะพะฒะธัะต ัะฐะนะป `driver-proxy.yaml` ะธ ะฟัะธะผะตะฝะธัะต ะธะทะผะตะฝะตะฝะธั:

```bash
kubectl apply -f driver-proxy.yaml
```

### 3. ะะฐะฟััะบ Spark ะฟัะธะปะพะถะตะฝะธั

```bash
python pyspark_on_kube_example.py
```

### 4. ะะพะฝะธัะพัะธะฝะณ

ะะพ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะผะพะถะฝะพ ะฝะฐะฑะปัะดะฐัั ะทะฐ ะฟะพะดะฐะผะธ:

```bash
# ะกะผะพััะตัั ะฟะพะดั ะฒ namespace spark
kubectl get pods -n spark -w

# ะะพะณะธ executor'ะฐ
kubectl logs -n spark <executor-pod-name>

# Spark UI (ะตัะปะธ ะฟะพัั 4040 ะพัะบััั)
# http://localhost:4040
```

---

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะพะบะฐะปัะฝะฐั ะผะฐัะธะฝะฐ (ะฒะฝะต Kubernetes)                          โ
โ                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ  โ  PySpark Driver                      โ                   โ
โ  โ  - ะะฐะฟััะบะฐะตั SparkSession            โ                   โ
โ  โ  - ะฃะฟัะฐะฒะปัะตั executor'ะฐะผะธ            โ                   โ
โ  โ  - ะกะปััะฐะตั ะฝะฐ ะฟะพััะฐั 7077, 7078      โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ           โ                                                   โ
โ           โ Kubernetes API                                   โ
โ           โผ                                                   โ
โโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
โโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Kubernetes Cluster                                            โ
โ           โ                                                   โ
โ           โผ                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ driver-proxy        โ         โ Executor Pod 1      โ    โ
โ  โ Service + Endpoints โโโโโโโโโโโค - ะัะฟะพะปะฝัะตั ะทะฐะดะฐัะธ  โ    โ
โ  โ (192.168.1.66)      โ         โ - ะัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ    โ
โ           โฒ                                                   โ
โ           โ                       โโโโโโโโโโโโโโโโโโโโโโโ    โ
โ           โโโโโโโโโโโโโโโโโโโโโโโโโค Executor Pod 2      โ    โ
โ                                   โ - ะัะฟะพะปะฝัะตั ะทะฐะดะฐัะธ  โ    โ
โ                                   โ - ะัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต โ    โ
โ                                   โโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                               โ
โ  namespace: spark                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะพะบ ะฒัะฟะพะปะฝะตะฝะธั

1. **ะะฝะธัะธะฐะปะธะทะฐัะธั:**
   - Python ัะบัะธะฟั ัะพะทะดะฐะตั SparkSession
   - Driver ะฐััะตะฝัะธัะธัะธััะตััั ะฒ K8s ัะตัะตะท minikube ัะตััะธัะธะบะฐัั
   - Driver ะธัะฟะพะปัะทัะตั ServiceAccount `spark-client` ะดะปั ัะพะทะดะฐะฝะธั ัะตััััะพะฒ

2. **ะกะพะทะดะฐะฝะธะต executor'ะพะฒ:**
   - Driver ัะพะทะดะฐะตั ConfigMap ั ะบะพะฝัะธะณััะฐัะธะตะน
   - Driver ัะพะทะดะฐะตั Pod'ั ะดะปั executor'ะพะฒ ะฒ namespace `spark`
   - Executor'ั ะทะฐะฟััะบะฐัััั ั ะพะฑัะฐะทะพะผ `apache/spark:3.4.4-python3`

3. **ะะพะผะผัะฝะธะบะฐัะธั:**
   - Executor'ั ะฟะพะดะบะปััะฐัััั ะบ `driver-proxy.spark.svc.cluster.local:7077`
   - Service ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตั ััะฐัะธะบ ะฝะฐ `192.168.1.66:7077` (ะฒะฐัะฐ ะผะฐัะธะฝะฐ)
   - Driver ะธ executor'ั ะพะฑะผะตะฝะธะฒะฐัััั ะทะฐะดะฐัะฐะผะธ ะธ ะดะฐะฝะฝัะผะธ

4. **ะัะฟะพะปะฝะตะฝะธะต job:**
   - Driver ะพัะฟัะฐะฒะปัะตั ะทะฐะดะฐัะธ executor'ะฐะผ
   - Executor'ั ะฒัะฟะพะปะฝััั ะฒััะธัะปะตะฝะธั
   - ะะตะทัะปััะฐัั ะฒะพะทะฒัะฐัะฐัััั driver'ั

5. **ะะฐะฒะตััะตะฝะธะต:**
   - `spark.stop()` ัะดะฐะปัะตั ะฒัะต executor ะฟะพะดั
   - ะัะธัะฐัััั ConfigMap'ั ะธ ะดััะณะธะต ัะตััััั

---

## ๐ก๏ธ Kyverno Policy Management

### ะัะธะผะตะฝะตะฝะธะต ะฟะพะปะธัะธะบะธ ะทะฐะฟัะตัะฐ

ะงัะพะฑั ะฒัะตะผะตะฝะฝะพ ะทะฐะฑะปะพะบะธัะพะฒะฐัั ะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั `pyspark-k8s-client`:

```bash
kubectl apply -f spark-app-banning-policy.yaml
```

ะะพะปะธัะธะบะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะฐะปะธััั ัะตัะตะท 15 ะผะธะฝัั.

### ะัะพัะผะพัั ะฟะพะปะธัะธะบ

```bash
# ะกะฟะธัะพะบ ะฒัะตั ClusterPolicy
kubectl get clusterpolicy

# ะะตัะฐะปะธ ะฟะพะปะธัะธะบะธ
kubectl describe clusterpolicy deny-spark-app-pyspark-k8s-client

# Policy Reporter UI (ะตัะปะธ ัััะฐะฝะพะฒะปะตะฝ)
# http://localhost:8082
```

### ะััะฝะพะต ัะดะฐะปะตะฝะธะต ะฟะพะปะธัะธะบะธ

```bash
kubectl delete clusterpolicy deny-spark-app-pyspark-k8s-client
kubectl delete job delete-spark-policy-after-15min -n kyverno
```

---

## ๐ Troubleshooting

### ะัะพะฑะปะตะผะฐ: SSL timeout ะฟัะธ ัะพะทะดะฐะฝะธะธ executor'ะพะฒ

**ะัะธัะธะฝะฐ:** ะะตะฟัะฐะฒะธะปัะฝะฐั ะฐััะตะฝัะธัะธะบะฐัะธั ะฒ Kubernetes API.

**ะะตัะตะฝะธะต:** ะัะพะฒะตัััะต ะฟััะธ ะบ ัะตััะธัะธะบะฐัะฐะผ ะฒ `pyspark_on_kube_example.py`:
```bash
ls -la ~/.minikube/ca.crt
ls -la ~/.minikube/profiles/minikube/client.key
ls -la ~/.minikube/profiles/minikube/client.crt
```

### ะัะพะฑะปะตะผะฐ: Executor'ั ะฝะต ะผะพะณัั ะฟะพะดะบะปััะธัััั ะบ driver

**ะัะธัะธะฝะฐ:** ะะตะฟัะฐะฒะธะปัะฝัะน IP ะฒ `driver-proxy.yaml`.

**ะะตัะตะฝะธะต:**
1. ะฃะทะฝะฐะนัะต IP ะฒะฐัะตะน ะผะฐัะธะฝั: `ip addr show`
2. ะะฑะฝะพะฒะธัะต IP ะฒ `driver-proxy.yaml`
3. ะัะธะผะตะฝะธัะต ะธะทะผะตะฝะตะฝะธั: `kubectl apply -f driver-proxy.yaml`

### ะัะพะฑะปะตะผะฐ: Permission denied ะฟัะธ ัะพะทะดะฐะฝะธะธ ะฟะพะดะพะฒ

**ะัะธัะธะฝะฐ:** RBAC ะฝะต ะฝะฐัััะพะตะฝ.

**ะะตัะตะฝะธะต:**
```bash
kubectl apply -f spark-rbac.yaml
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [Apache Spark on Kubernetes](https://spark.apache.org/docs/latest/running-on-kubernetes.html)
- [Kyverno Documentation](https://kyverno.io/docs/)
- [Minikube Documentation](https://minikube.sigs.k8s.io/docs/)

---

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ะพะฑัะฐะทะพะฒะฐัะตะปัะฝัั ัะตะปะตะน.
